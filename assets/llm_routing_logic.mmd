graph LR
    A[User Input] --> B(Task Analyzer)
    B --> C{Task Context}
    C --> D{API Key Available?}
    D -- Yes --> E{User Preference?}
    E -- Yes --> F{Filter LLMs by Preference}
    E -- No --> G{Available LLMs}
    F --> G
    G --> H{Rule-Based Router}
    H --> I{Rule LLM, Rule Confidence}
    G --> J{Bandit Router: Sufficient Data?}
    J -- Yes --> K{Select Bandit Arm}
    K --> L{Bandit LLM, Bandit Confidence}
    J -- No --> M{Use Rule LLM}
    L --> N{Bandit Confidence > Threshold AND Bandit Confidence > Rule Confidence?}
    N -- Yes --> O[Select Bandit LLM]
    N -- No --> P[Select Rule LLM]
    I --> M
    M --> P
    O --> Q(Routing Decision)
    P --> Q
    Q --> R[Selected LLM]
    R --> S(LLM Call)
    S --> T[Response]

    style A fill:#f9f,stroke:#333,stroke-width:2px
    style B fill:#ccf,stroke:#333,stroke-width:2px
    style C fill:#ccf,stroke:#333,stroke-width:2px
    style D fill:#ccf,stroke:#333,stroke-width:2px
    style E fill:#ccf,stroke:#333,stroke-width:2px
    style F fill:#ccf,stroke:#333,stroke-width:2px
    style G fill:#ccf,stroke:#333,stroke-width:2px
    style H fill:#ccf,stroke:#333,stroke-width:2px
    style I fill:#ccf,stroke:#333,stroke-width:2px
    style J fill:#ccf,stroke:#333,stroke-width:2px
    style K fill:#ccf,stroke:#333,stroke-width:2px
    style L fill:#ccf,stroke:#333,stroke-width:2px
    style M fill:#ccf,stroke:#333,stroke-width:2px
    style N fill:#ccf,stroke:#333,stroke-width:2px
    style O fill:#ccf,stroke:#333,stroke-width:2px
    style P fill:#ccf,stroke:#333,stroke-width:2px
    style Q fill:#f9f,stroke:#333,stroke-width:2px
    style R fill:#f9f,stroke:#333,stroke-width:2px
    style S fill:#f9f,stroke:#333,stroke-width:2px
    style T fill:#f9f,stroke:#333,stroke-width:2px

